<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

<div class="container">
<div class="center jumbotron squidb" style="">
<% provide(:title, 'Task List') %>
<p id="notice"><%= notice %></p>

<h1>Open Tasks</h1>

<div align="center"><table>
    <thead>
      <tr>
        <th>Description</th>
        <th>Title</th>
        <th>User</th>
        <th>Payment Description</th>
        <th>Category</th>
        <th>Runner</th>
        <th>Status</th>
        <th>Actions</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @tasks.each do |task| %>
        <tr>
          <td title = '<%= task.description %>'><%= task.description.first(40) %></td>
          <td title = '<%= task.title %>'><%= task.title.first(40) %></td>
          <td><%= task.user_id %></td>
          <td><%= task.payment_description %></td>
          <td><%= task.category %></td>
          <td><%= task.runner_id %></td>
          <td><%= task.status %></td>
          <!--<td><%= link_to 'Accept', task, method: :put, data: { confirm: 'Are you sure you want to accept this task?' } %></td>-->
          <% if user_signed_in? && (current_user.id == task.user_id || current_user.id == task.runner_id) && (task.status == 1)%>
            <td><%= link_to 'Mark Done', markdone_task_path(task) %></td>
          <% end %>
          <% if user_signed_in? && (current_user.id == task.runner_id) && (task.status == 1) %>
            <%= link_to 'Unaccept', unaccept_task_path(task) %>
          <% end %>
          <% if user_signed_in? && (task.status == 0) && (current_user.id != task.user_id)%>
            <td><%= link_to 'Accept', accept_task_path(task) %></td>
          <% end %>
          <td><%= link_to 'Show', task %></td>
          <% if user_signed_in? && (current_user.admin? || current_user.id == task.user_id) %>
            <td><%= link_to 'Edit', edit_task_path(task) %></td>
           <% end %>
          <% if user_signed_in? && (current_user.admin? || current_user.id == task.user_id) %>
            <td><%= link_to 'Destroy', task, method: :delete, data: { confirm: 'Are you sure you want to delete this task?' } %></td>
           <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
  <br>
  <div style='width: 800px;'>
    <div id="map" style='width: 800px; height: 400px;'></div>
  </div>

  <script type="text/javascript">
  // handler = Gmaps.build('Google');
  // handler.buildMap({
  //     provider: {
  //       disableDefaultUI: true,
  //       // auto_adjust: true,
  //       auto_zoom: false,
  //       // bounds: [{"lat": 44.34685, "lng": -74.65528}, {"lat": 44.34688, "lng": -74.65532}],
  //       // draggable: true,
  //       // center_latitude : 44.34685,
  //       // center_longitude: -74.65528,
  //       zoom: 15
  //       // pass in other Google Maps API options here
  //     },
  //     internal: {
  //       id: 'map'
  //     }
  //   },
  //   function(){
  //     markers = handler.addMarkers([
  //       {
  //         //"zoom": 5,
  //         //"auto_zoom": false,
  //         "lat": 40.34685,
  //         "lng": -74.65528,
  //         // "picture": {
  //         //   "url": "https://addons.cdn.mozilla.net/img/uploads/addon_icons/13/13028-64.png",
  //         //   "width":  36,
  //         //   "height": 36
  //         // },
  //         "infowindow": "hello!"
  //       }
  //     ]);
  //     handler.bounds.extendWith(markers);
  //     handler.fitMapToBounds();
  //     //handler.map.centerOn(markers);
  //     //handler.getMap.setZoom(3);

  //   }
  // );
handler = Gmaps.build('Google');
      handler.buildMap({
      provider: {
        draggable: true,
        Zoom: 16
      },
      internal: {
        id: 'map'
      }
    },
    function(){
      marker = handler.addMarker(
        {
          "lat": 40.34685,
          "lng": -74.65528,
          // "picture": {
          //   "url": "https://addons.cdn.mozilla.net/img/uploads/addon_icons/13/13028-64.png",
          //   "width":  36,
          //   "height": 36
          // },
          "infowindow": "Center of campus!"
        }
      );
      handler.map.centerOn(marker);
    }
  );
  </script>

</div>
<br>
</div>
</div>
