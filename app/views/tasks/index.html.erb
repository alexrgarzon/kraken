<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

<div class="container">
<div class="center jumbotron squidb" style="">
<% provide(:title, 'Task List') %>
<p id="notice"><%= notice %></p>

<h1>Open Tasks</h1>
<div align="center"><table>
    <thead>
      <tr>
        <th><%= link_to "Title", :sort => "title"%></th>
        <th><%= link_to "Description", :sort => "description"%></th>
        <th><%= link_to "User", :sort => "user_id"%></th>
        <th><%= link_to "Payment", :sort => "payment_description"%></th>
        <th><%= link_to "Category", :sort => "category"%></th>
        <th><%= link_to "Runner", :sort => "runner_id"%></th>
        <th><%= link_to "Status", :sort => "status"%></th>
        <th><%= link_to "Address", :sort => "address"%></th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @tasks.each do |task| %>
        <tr>
            <td title = '<%= task.title %>'><%= task.title.first(20) %></td>
            <td title = '<%= task.description %>'><%= task.description.first(20) %></td>
          <td><%= userAsString(task.user_id) %></td>
          <td><%= task.payment_description %></td>
          <% if task.category %>
             <td><%= link_to task.category.name, task.category %></td>
           <% else %>
              <td> None </td>
           <% end %>
          <td><%= userAsString(task.runner_id) %></td>



          <td><%= statusAsString(task.status) %></td>
          <td><%= task.address %></td>
          <!--<td><%= link_to 'Accept', task, method: :put, data: { confirm: 'Are you sure you want to accept this task?' } %></td>-->
          <% if user_signed_in? && (current_user.id == task.user_id || current_user.id == task.runner_id) && (task.status == 1)%>
            <td><%= link_to 'Mark Done', markdone_task_path(task) %></td>
          <% end %>
          <% if user_signed_in? && (current_user.id == task.runner_id) && (task.status == 1) %>
            <td><%= link_to 'Unaccept', unaccept_task_path(task) %></td>
          <% end %>
          <% if user_signed_in? && (task.status == 0) && (current_user.id != task.user_id)%>
            <td><%= link_to 'Accept', accept_task_path(task) %></td>
          <% end %>
          <td><%= link_to 'Show', task %></td>
          <% if user_signed_in? && (current_user.admin? || current_user.id == task.user_id) %>
            <td><%= link_to 'Edit', edit_task_path(task) %></td>
           <% end %>
          <% if user_signed_in? && (current_user.admin? || current_user.id == task.user_id) %>
            <td><%= link_to 'Destroy', task, method: :delete, data: { confirm: 'Are you sure you want to delete this task?' } %></td>
           <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
  <br>
  <div style='width: 800px;'>
    <div id="map" style='width: 800px; height: 400px;'></div>
  </div>



  <script type="text/javascript">
handler = Gmaps.build('Google');
      handler.buildMap({
      provider: {
        draggable: true,
        Zoom: 16
      },
      internal: {
        id: 'map'
      }
    },
    function(){
      marker = handler.addMarker(
        {
          "lat": 40.34685,
          "lng": -74.65528,
          "picture": {
            "url": "intentionalerror",
            "width":  36,
            "height": 36
          },
          "infowindow": "Center of campus!"
        }
      );
      markers = handler.addMarkers(<%=raw @hash.to_json %>);
      handler.map.centerOn(marker);
      // marker.setVisible(false);

    }
  );
  </script>

</div>
<br>
</div>
</div>
